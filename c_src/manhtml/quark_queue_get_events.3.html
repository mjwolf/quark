<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="mandoc.css" type="text/css" media="all"/>
  <title>QUARK_QUEUE_GET_EVENTS(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">QUARK_QUEUE_GET_EVENTS(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">QUARK_QUEUE_GET_EVENTS(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">quark_queue_get_events</code> &#x2014;
    <span class="Nd">main quark driver</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
  &lt;<a class="In">quark.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">quark_queue_get_events</code>(<var class="Fa" style="white-space: nowrap;">struct
    quark_queue *qq</var>, <var class="Fa" style="white-space: nowrap;">struct
    quark_event *qev</var>, <var class="Fa" style="white-space: nowrap;">int
    nqev</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><code class="Nm">quark_queue_get_events</code> fills the array of
    events pointed to by <var class="Fa">qev</var> to a maximum of
    <var class="Fa">neqv</var> entries.</p>
<p class="Pp">This function is the main driver of quark. Quark doesn't create
    threads or introduces hidden control flows, all its state is mutated through
    this function call. For a better explanation of quark's design, refer to
    <a class="Xr" href="quark.7.html">quark(7)</a>. A summary of what this
    function does:</p>
<ul class="Bl-bullet">
  <li>Populates its priority queue with raw events by calling into the backend
      populate function.</li>
  <li>Attempts to collect raw events that are deemed old enough from its
      priority queue, if successfull tries to aggregate such events.</li>
  <li>Converts the collected raw events into proper
      <var class="Vt">quark_events</var>. This involves consulting its internal
      cache and enriching said events. These <var class="Vt">quark_events</var>
      are then passed to the user via <var class="Fa">qev</var>.</li>
  <li>Garbage collects cached events that are marked for deletion and are old
      enough. When a process exits, its event cache is marked for deletion, but
      a grace time is given before purging it so that the user might still query
      it for some time.</li>
</ul>
<p class="Pp">A <var class="Vt">quark_event</var> has three main members:</p>
<dl class="Bl-tag">
  <dt id="pid"><a class="permalink" href="#pid"><i class="Em">pid</i></a></dt>
  <dd>The pid of the originating event.</dd>
  <dt id="events"><a class="permalink" href="#events"><i class="Em">events</i></a></dt>
  <dd>A bitmask representing the events that originated this
      <var class="Vt">quark_event</var>:
    <dl class="Bl-tag Bl-compact">
      <dt id="QUARK_EV_FORK"><a class="permalink" href="#QUARK_EV_FORK"><code class="Dv">QUARK_EV_FORK</code></a></dt>
      <dd>New process, result of a fork.</dd>
      <dt id="QUARK_EV_EXEC"><a class="permalink" href="#QUARK_EV_EXEC"><code class="Dv">QUARK_EV_EXEC</code></a></dt>
      <dd>Process changed image, result of an exec.</dd>
      <dt id="QUARK_EV_EXIT"><a class="permalink" href="#QUARK_EV_EXIT"><code class="Dv">QUARK_EV_EXIT</code></a></dt>
      <dd>Process exited.</dd>
      <dt id="QUARK_EV_SETPROCTITLE"><a class="permalink" href="#QUARK_EV_SETPROCTITLE"><code class="Dv">QUARK_EV_SETPROCTITLE</code></a></dt>
      <dd>Process changed its name (COMM).</dd>
    </dl>
    <p class="Pp">It's important to notice that <var class="Vt">events</var> is
        what triggered the event, not what is known about the event, that's
        expressed in <i class="Em">flags</i> below.</p>
    <p class="Pp" id="QUARK_EV_EXEC~2">It might also be more than one value as
        events get aggregated. For example, a short lived process will have the
        following mask: <code class="Dv">QUARK_EV_FORK</code> |
        <a class="permalink" href="#QUARK_EV_EXEC~2"><code class="Dv">QUARK_EV_EXEC</code></a>
        |
        <a class="permalink" href="#QUARK_EV_EXIT~2"><code class="Dv" id="QUARK_EV_EXIT~2">QUARK_EV_EXIT</code></a>.</p>
  </dd>
  <dt id="flags"><a class="permalink" href="#flags"><i class="Em">flags</i></a></dt>
  <dd>A bit mask representing the fields which are known about this pid, these
      can be cached and originate from previous events. Each bit in the set
      represents one or more members of the structure, if the bit is unset, the
      respective members are invalid/unknown.
    <p class="Pp"></p>
    <dl class="Bl-tag Bl-compact">
      <dt id="QUARK_F_PROC"><a class="permalink" href="#QUARK_F_PROC"><code class="Dv">QUARK_F_PROC</code></a></dt>
      <dd><a class="permalink" href="#proc_"><i class="Em" id="proc_">proc_</i></a>
          members are valid.</dd>
      <dt id="QUARK_F_EXIT"><a class="permalink" href="#QUARK_F_EXIT"><code class="Dv">QUARK_F_EXIT</code></a></dt>
      <dd><a class="permalink" href="#exit_code"><i class="Em" id="exit_code">exit_code</i></a>
          is valid.</dd>
      <dt id="QUARK_F_COMM"><a class="permalink" href="#QUARK_F_COMM"><code class="Dv">QUARK_F_COMM</code></a></dt>
      <dd><a class="permalink" href="#comm"><i class="Em" id="comm">comm</i></a>
          is valid.</dd>
      <dt id="QUARK_F_FILENAME"><a class="permalink" href="#QUARK_F_FILENAME"><code class="Dv">QUARK_F_FILENAME</code></a></dt>
      <dd><a class="permalink" href="#filename"><i class="Em" id="filename">filename</i></a>
          is valid.</dd>
      <dt id="QUARK_F_CMDLINE"><a class="permalink" href="#QUARK_F_CMDLINE"><code class="Dv">QUARK_F_CMDLINE</code></a></dt>
      <dd><a class="permalink" href="#cmdline"><i class="Em" id="cmdline">cmdline</i></a>
          and
          <a class="permalink" href="#cmdline_len"><i class="Em" id="cmdline_len">cmdline_len</i></a>
          are valid.</dd>
      <dt id="QUARK_F_CWD"><a class="permalink" href="#QUARK_F_CWD"><code class="Dv">QUARK_F_CWD</code></a></dt>
      <dd><a class="permalink" href="#cwd"><i class="Em" id="cwd">cwd</i></a> is
          valid.</dd>
    </dl>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">The number of filled events via <var class="Fa">qev</var> to a
    maximum of <var class="Fa">nqev</var>. If zero is returned, the user should
    consider calling
    <a class="Xr" href="quark_queue_block.3.html">quark_queue_block(3)</a>. In
    the case of an internal error, -1 is returned and
    <var class="Va">errno</var> is set.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="quark_event_dump.3.html">quark_event_dump(3)</a>,
    <a class="Xr" href="quark_event_lookup.3.html">quark_event_lookup(3)</a>,
    <a class="Xr" href="quark_queue_block.3.html">quark_queue_block(3)</a>,
    <a class="Xr" href="quark_queue_close.3.html">quark_queue_close(3)</a>,
    <a class="Xr" href="quark_queue_get_epollfd.3.html">quark_queue_get_epollfd(3)</a>,
    <a class="Xr" href="quark_queue_get_stats.3.html">quark_queue_get_stats(3)</a>,
    <a class="Xr" href="quark_queue_open.3.html">quark_queue_open(3)</a>,
    <a class="Xr" href="quark.7.html">quark(7)</a>,
    <a class="Xr" href="quark-btf.8.html">quark-btf(8)</a>,
    <a class="Xr" href="quark-mon.8.html">quark-mon(8)</a></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">May 22, 2024</td>
    <td class="foot-os">Linux 6.8.7-200.fc39.aarch64</td>
  </tr>
</table>
</body>
</html>
